üìò docs/dev/guardrails.md
Ly[x]an AOS ‚Äî Development Guardrails v1

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –≤—Å–µ—Ö –º–æ–¥—É–ª–µ–π Ly[x]an AOS.
–¶–µ–ª—å ‚Äî –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç—å –ø–æ—è–≤–ª–µ–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫, –∫–æ—Ç–æ—Ä—ã–µ —Å–µ–π—á–∞—Å –≤—ã—è–≤–ª—è—é—Ç—Å—è –≤—Ä—É—á–Ω—É—é –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ –≤ UI.

Guardrails v1 –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∫–æ –≤—Å–µ–º –Ω–æ–≤—ã–º –ø–∞—Ç—á–∞–º, —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞–º –∏ —Ñ–∏—á–∞–º, —Å–æ–∑–¥–∞–≤–∞–µ–º—ã–º –∫–∞–∫ —á–µ–ª–æ–≤–µ–∫–æ–º, —Ç–∞–∫ –∏ AI-–∞–≥–µ–Ω—Ç–æ–º.

üß≠ 1. –û–±—â–∏–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –º–æ–¥—É–ª–∏ AOS (SCM, Finance, BCM, OS-Core) –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞—â–∏—â–µ–Ω—ã –∞–≤—Ç–æ—Ç–µ—Å—Ç–∞–º–∏.

–ù–∏ –æ–¥–∏–Ω —ç–Ω–¥–ø–æ–∏–Ω—Ç –Ω–µ –¥–æ–ª–∂–µ–Ω –æ—Ç–≤–µ—á–∞—Ç—å 500, –∫—Ä–æ–º–µ —Å–ª—É—á–∞–µ–≤ —Ä–µ–∞–ª—å–Ω–æ–π –∞–≤–∞—Ä–∏–∏.

CRUD-–æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–æ–ª–∂–Ω—ã –∏–º–µ—Ç—å e2e-—Ç–µ—Å—Ç—ã –Ω–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –≤–∞–ª–∏–¥–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π.

–õ—é–±–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –≤ Prisma, DTO, enum –∏–ª–∏ API –¥–æ–ª–∂–Ω–æ —Å–æ–ø—Ä–æ–≤–æ–∂–¥–∞—Ç—å—Å—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º —Ç–µ—Å—Ç–æ–≤.

Frontend –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å smoke-—Ç–µ—Å—Ç—ã, –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É—é—â–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ ‚Äú–±–µ–ª—ã—Ö —ç–∫—Ä–∞–Ω–æ–≤‚Äù.

üß© 2. –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ backend
2.1. API Stability Tests (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)

–î–ª—è –∫–∞–∂–¥–æ–≥–æ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞ —É—Ä–æ–≤–Ω—è:

Suppliers

Manufacturers

Warehouses

Supplies

Production Orders

Finance Documents

–¥–æ–ª–∂–µ–Ω —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π e2e API —Ç–µ—Å—Ç, –∫–æ—Ç–æ—Ä—ã–π:

–≤—ã–ø–æ–ª–Ω—è–µ—Ç POST —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º –≤–∞–ª–∏–¥–Ω—ã–º payload,

–≤—ã–ø–æ–ª–Ω—è–µ—Ç GET,

–ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ —Å—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞ 2xx, –∞ –Ω–µ 4xx/5xx.

–ù–∞–ø—Ä–∏–º–µ—Ä:

expect(res.status).toBeLessThan(300);


–ï—Å–ª–∏ —Ç–µ—Å—Ç –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω ‚Äî –ø–∞—Ç—á —Å—á–∏—Ç–∞–µ—Ç—Å—è –Ω–µ–ø–æ–ª–Ω—ã–º.

2.2. Query Parameter Guardrails

–õ—é–±–æ–π query-–ø–∞—Ä–∞–º–µ—Ç—Ä –≤ API –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —É—Å—Ç–æ–π—á–∏–≤ –∫ —Å—Ç—Ä–æ–∫–æ–≤—ã–º –∑–Ω–∞—á–µ–Ω–∏—è–º:

–ü–∞—Ä–∞–º–µ—Ç—Ä	–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ
isActive	–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–∏–≤–æ–¥–∏—Ç—Å—è –∫ boolean –≤ DTO —á–µ—Ä–µ–∑ Transform
limit	–æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç—Å—è take = Math.min(limit, 100)
type	–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å enum —Å fallback

E2e-—Ç–µ—Å—Ç—ã –¥–æ–ª–∂–Ω—ã –ø—Ä–æ–≤–µ—Ä—è—Ç—å:

GET /items?isActive=true ‚Üí 200
GET /items?isActive=false ‚Üí 200
GET /items?limit=1000 ‚Üí <=100 results, no 400/500

2.3. Enum Synchronization (backend ‚Üî shared ‚Üî frontend)

–í—Å–µ enum-–∑–Ω–∞—á–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã –Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤ shared workspace.

–ù–∞–ø—Ä–∏–º–µ—Ä:

// shared/src/enums/scm.ts
export enum SupplierRole {
  PRODUCER = 'PRODUCER',
  RAW_MATERIAL = 'RAW_MATERIAL',
  PACKAGING = 'PACKAGING',
  PRINTING = 'PRINTING',
  LOGISTICS = 'LOGISTICS',
  OTHER = 'OTHER',
}


Backend –∑–∞–ø—Ä–µ—â–µ–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ –Ω–µ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ enum‚Äô—ã.

Contract-test (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ):
expect(Object.values(BackendRoleEnum)).toEqual(Object.values(SharedRoleEnum));


–ï—Å–ª–∏ –∫—Ç–æ-—Ç–æ –¥–æ–±–∞–≤–∏–ª enum —Ç–æ–ª—å–∫–æ –≤ backend ‚Üí —Ç–µ—Å—Ç —É–ø–∞–¥—ë—Ç.

2.4. Prisma Schema Guardrails

–õ—é–±–æ–µ –Ω–æ–≤–æ–µ –ø–æ–ª–µ –≤ –º–æ–¥–µ–ª—è—Ö Prisma —Ç—Ä–µ–±—É–µ—Ç:

–º–∏–≥—Ä–∞—Ü–∏—é (npx prisma migrate dev --name <update>),

e2e-—Ç–µ—Å—Ç—ã —Å–æ–∑–¥–∞—é—â–µ–≥–æ (POST) –∏ —á–∏—Ç–∞—é—â–µ–≥–æ (GET) —Å—Ü–µ–Ω–∞—Ä–∏—è.

–ó–∞–ø—Ä–µ—â–µ–Ω–æ:

–¥–æ–±–∞–≤–ª—è—Ç—å –ø–æ–ª–µ –≤ Prisma –±–µ–∑ –º–∏–≥—Ä–∞—Ü–∏–∏;

—Å—Å—ã–ª–∞—Ç—å—Å—è –≤ TS-–∫–æ–¥–µ –Ω–∞ –ø–æ–ª–µ, –∫–æ—Ç–æ—Ä–æ–≥–æ –Ω–µ—Ç –≤ —Ç–∞–±–ª–∏—Ü–µ;

Test example:
it('creates supplier with EDO fields', async () => {
  const res = await request(app.getHttpServer())
    .post('/scm/suppliers')
    .send({ name: 'Test', edoSystem: 'SBIS' });

  expect(res.status).toBe(201);
  expect(res.body.edoSystem).toBe('SBIS');
});

üé® 3. –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ frontend
3.1. No ‚ÄúWhite Screen‚Äù Guarantee (smoke tests)

–î–ª—è –≤—Å–µ—Ö protected –º–∞—Ä—à—Ä—É—Ç–æ–≤ SCM/Finance –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –Ω–∞–ª–∏—á–∏–µ smoke-—Ç–µ—Å—Ç–∞ (Playwright):

test('Supplier create page loads without errors', async ({ page }) => {
  const errors = [];
  page.on('pageerror', (err) => errors.push(err));

  await page.goto('/scm/suppliers/new');
  await expect(page.getByText('Additional Legal Info')).toBeVisible();
  
  expect(errors).toHaveLength(0);
});


Smoke-—Ç–µ—Å—Ç—ã –¥–æ–ª–∂–Ω—ã –ø–æ–∫—Ä—ã–≤–∞—Ç—å:

/scm/suppliers/new

/scm/manufacturers/new

/scm/warehouses/new

/scm/supplies/new

/scm/production-orders/new

/finance/documents

3.2. Select Safety

–í—Å–µ Select-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –æ–±—è–∑–∞–Ω—ã:

–∏–º–µ—Ç—å value ?? ""

—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å —ç–ª–µ–º–µ–Ω—Ç—ã –±–µ–∑ id

–∏–º–µ—Ç—å fallback "No data"

–ü—Ä–∏–º–µ—Ä:

<Select value={value ?? ''}>
  {items?.filter(i => i?.id).map(i => (
    <SelectItem key={i.id} value={i.id}>{i.name}</SelectItem>
  ))}
</Select>

3.3. Shared Types

Frontend –¥–æ–ª–∂–µ–Ω –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å enum‚Äô—ã –∏ —Ç–∏–ø—ã –∏–∑:

shared/src/types/
shared/src/enums/


–ó–∞–ø—Ä–µ—â–µ–Ω–æ –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å enum-—Å—Ç—Ä–æ–∫–∏ –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ –≤—Ä—É—á–Ω—É—é.

üîí 4. Rules for Pull Requests & AI Patches

–ö–∞–∂–¥—ã–π PR –∏–ª–∏ AI-–ø–∞—Ç—á –æ–±—è–∑–∞–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å:

‚úî 1. –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∫–æ–¥–∞
‚úî 2. –û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–µ e2e-—Ç–µ—Å—Ç—ã
‚úî 3. –û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–µ smoke-—Ç–µ—Å—Ç—ã, –µ—Å–ª–∏ UI –∑–∞—Ç—Ä–æ–Ω—É—Ç
‚úî 4. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π Prisma, –µ—Å–ª–∏ –±—ã–ª–∏ schema-–∏–∑–º–µ–Ω–µ–Ω–∏—è
‚úî 5. –ü—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ –≤—Å–µ—Ö –∫–æ–º–∞–Ω–¥:
pnpm test
pnpm test:e2e
pnpm test:smoke
pnpm build


–ï—Å–ª–∏ –∫–∞–∫–æ–π-–ª–∏–±–æ —Ç–µ—Å—Ç –ø–∞–¥–∞–µ—Ç ‚Üí PR –∑–∞–ø—Ä–µ—â–∞–µ—Ç—Å—è.

üö® 5. Automated Failure Conditions

PR –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è, –µ—Å–ª–∏:

–µ—Å—Ç—å –∑–∞–ø—Ä–æ—Å, –≤–æ–∑–≤—Ä–∞—â–∞—é—â–∏–π 500 –Ω–∞ –±–∞–∑–æ–≤–æ–º —Å—Ü–µ–Ω–∞—Ä–∏–∏;

–µ—Å—Ç—å –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ enum‚Äô–æ–≤ –º–µ–∂–¥—É shared ‚Üî backend ‚Üî frontend;

DTO –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–º—É payload‚Äô—É —Ñ—Ä–æ–Ω—Ç–∞;

Prisma-–º–æ–¥–µ–ª—å –∏–∑–º–µ–Ω–∏–ª–∞—Å—å –±–µ–∑ –º–∏–≥—Ä–∞—Ü–∏–∏;

smoke-—Ç–µ—Å—Ç –≤—ã—è–≤–∏–ª –æ—à–∏–±–∫–∏ –≤ pageerror.

üß™ 6. Minimum Required Tests per Module

–ö–∞–∂–¥—ã–π SCM-–º–æ–¥—É–ª—å –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å:

–ú–æ–¥—É–ª—å	–¢–µ—Å—Ç—ã
Suppliers	create, get, items query, services query, link-product
Manufacturers	create, get, list
Warehouses	create, get, list
Supplies	create, get, validate items array
Production Orders	create, get, status transitions
Finance Documents	create for each type, get list

–ï—Å–ª–∏ –º–æ–¥—É–ª—å –Ω–µ –∏–º–µ–µ—Ç –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ –Ω–∞–±–æ—Ä–∞ ‚Äî –æ–Ω —Å—á–∏—Ç–∞–µ—Ç—Å—è –Ω–µ–∑–∞—â–∏—â—ë–Ω–Ω—ã–º.

üîß 7. Developer Checklist

–ü–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º:

 –í—Å–µ API –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç 2xx –Ω–∞ happy path

 –ù–µ—Ç 500 –≤ –ª–æ–≥–µ backend

 –§—Ä–æ–Ω—Ç–µ–Ω–¥ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –æ—Ç–∫—Ä—ã–≤–∞—é—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫

 –í—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã

 –¢–µ—Å—Ç—ã –∑–µ–ª—ë–Ω—ã–µ

 Shared enum‚Äô—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

 –ù–µ—Ç —Ä—É—á–Ω—ã—Ö —Å—Ç—Ä–æ–∫–æ–≤—ã—Ö ENUM-–∑–Ω–∞—á–µ–Ω–∏–π

üßø 8. –¶–µ–ª—å Guardrails v1

–°–≤–µ—Å—Ç–∏ –∫ –Ω—É–ª—é —Ä—É—á–Ω–æ–π –ø–æ–∏—Å–∫ –æ—à–∏–±–æ–∫ –≤—Ä–æ–¥–µ:

‚Äú–∫–æ–ª–æ–Ω–∫–∞ X –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç‚Äù,

‚Äúenum –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç‚Äù,

‚ÄúSelect –ø–∞–¥–∞–µ—Ç –∏–∑-–∑–∞ undefined‚Äù,

‚ÄúisActive=true –ª–æ–º–∞–µ—Ç backend‚Äù,

‚Äúfrontend –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –±–µ–ª—ã–π —ç–∫—Ä–∞–Ω‚Äù.

Guardrails v1 ‚Äî —ç—Ç–æ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –Ω–∞–±–æ—Ä –ø—Ä–∞–≤–∏–ª, –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É—é—â–∏–π —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å AOS –ø—Ä–∏ –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ, –≤–∫–ª—é—á–∞—è —Ä–∞–±–æ—Ç—É AI-–∞–≥–µ–Ω—Ç–æ–≤.

---
alwaysApply: true
---
