# Ly[x]an AOS Frontend

Frontend для Ly[x]an AOS — Agentic Operating System для управления e-commerce.

## Технологический стек

- **Next.js 16** — React фреймворк с App Router
- **TypeScript** — типизированный JavaScript
- **Tailwind CSS** — utility-first CSS framework
- **Shadcn UI** — компоненты UI на основе Radix UI
- **React 19** — библиотека для создания пользовательских интерфейсов

## Структура проекта

```
frontend/
├── app/                    # Next.js App Router
│   ├── layout.tsx         # Глобальный layout
│   ├── page.tsx           # Главная страница (dashboard)
│   ├── globals.css        # Глобальные стили
│   ├── scm/               # SCM модуль
│   ├── bcm/               # BCM модуль
│   ├── finance/           # Finance модуль
│   ├── advertising/       # Advertising модуль
│   ├── support/           # Support модуль
│   ├── analytics/         # Analytics модуль
│   └── settings/          # Settings модуль
├── components/            # React компоненты
│   ├── ui/               # Shadcn UI компоненты
│   ├── main-layout.tsx   # Основной layout с меню
│   └── top-nav.tsx       # Компонент верхнего меню
├── lib/                  # Утилиты
│   └── utils.ts          # Утилиты (cn для классов)
├── public/               # Статические файлы
├── package.json
├── tailwind.config.ts    # Конфигурация Tailwind
└── components.json       # Конфигурация Shadcn UI
```

## Установка

```bash
# Из корня монорепозитория
pnpm install

# Или из директории frontend
cd frontend
pnpm install
```

## Запуск

```bash
# Из корня монорепозитория
pnpm -F frontend dev

# Или из директории frontend
cd frontend
pnpm dev
```

Откройте [http://localhost:3000](http://localhost:3000) в браузере.

## Модули AOS

Frontend содержит следующие разделы:

- **SCM** — `/scm` — Supply Chain Management (управление цепочкой поставок)
  - `/scm/products` — управление товарами
  - `/scm/products/[id]` — детальная информация о товаре
  - `/scm/stocks` — управление остатками
  - `/scm/supplies` — управление поставками
- **BCM** — `/bcm` — Brand & Catalog Management (управление брендами и каталогом)
  - `/bcm/brand` — настройки бренда
  - `/bcm/products` — каталог товаров
  - `/bcm/products/[id]` — редактирование карточки товара
- **Finance** — `/finance` — Финансы (финансовые отчёты)
  - `/finance/sales` — таблица продаж
  - `/finance/pnl` — Profit & Loss отчёт
- **Advertising** — `/advertising` — Реклама (рекламные кампании)
  - `/advertising/campaigns` — список кампаний
  - `/advertising/campaigns/[id]` — карточка кампании с статистикой
- **Support** — `/support` — Поддержка (поддержка клиентов)
  - `/support/reviews` — отзывы о товарах
  - `/support/tickets` — обращения и тикеты
  - `/support/tickets/[id]` — детальная информация о тикете
- **Analytics** — `/analytics` — Аналитика (анализ данных)
- **Settings** — `/settings` — Настройки (конфигурация системы)

### SCM Module — Supply Chain Management

Модуль для управления цепочкой поставок реализован на этапе 0.

#### Страницы

- **`/scm/products`** — список товаров
  - Таблица с товарами, брендами, маркетплейсами, SKU кодами, ценами и остатками
  - Фильтры по названию товара и SKU коду
  - Кнопка создания нового товара
  
- **`/scm/products/[id]`** — детальная информация о товаре
  - Базовая информация о товаре
  - Список всех SKU с ценами, себестоимостью и остатками
  
- **`/scm/stocks`** — управление остатками
  - Таблица остатков по SKU
  - Возможность изменения количества inline
  
- **`/scm/supplies`** — управление поставками
  - Список всех поставок с статусами
  - Информация о количестве позиций и товаров

#### Интеграция с Backend

Все страницы SCM модуля интегрированы с REST API:
- Используется `lib/api.ts` для HTTP-запросов
- Данные загружаются с backend при открытии страницы
- Поддержка фильтрации и пагинации (где применимо)

#### Компоненты

- Используются Shadcn UI компоненты: `Table`, `Card`, `Button`, `Input`
- Адаптивный дизайн с использованием Tailwind CSS

### BCM Module — Brand & Catalog Management

Модуль для управления брендами и каталогом товаров реализован на этапе 0.

#### Страницы

- **`/bcm/brand`** — настройки бренда
  - Редактирование названия, кода и страны бренда
  - Выбор страны из списка
  
- **`/bcm/products`** — каталог товаров
  - Таблица товаров с информацией о карточках
  - Статусы карточек: Complete, Needs work, No card
  - Переход к редактированию карточки товара
  
- **`/bcm/products/[id]`** — редактирование карточки товара
  - Вкладки: General, Attributes, Images
  - Редактирование заголовка и описания
  - Редактирование атрибутов в JSON формате
  - Управление галереей изображений (URL)

#### Интеграция с Backend

Все страницы BCM модуля интегрированы с REST API:
- Загрузка информации о бренде и странах
- Получение списка товаров с карточками
- Создание и обновление карточек товаров

#### Компоненты

- Используются Shadcn UI компоненты: `Tabs`, `Textarea`, `Select`, `Card`, `Button`, `Input`
- Формы с валидацией и сохранением данных

### Finance Module — Финансовый модуль

Модуль для управления финансовыми отчётами и расчёта P&L реализован на этапе 0.

#### Страницы

- **`/finance/sales`** — таблица продаж
  - Таблица финансовых отчётов с колонками: Date, SKU Code, Quantity, Revenue, Commission, Refunds
  - Фильтры по дате (от/до) и SKU
  - Модальное окно для добавления новой финансовой строки
  - Поля формы: SKU, дата, количество, revenue, commission, refunds
  
- **`/finance/pnl`** — Profit & Loss отчёт
  - Карточки с метриками:
    - Revenue (выручка)
    - Commission (комиссия)
    - Refunds (возвраты)
    - Cost (себестоимость)
    - Gross Margin (валовая маржа)
    - Gross Margin % (валовая маржа в процентах)
  - Фильтр по дате (от/до)
  - Кнопка "Обновить" для пересчёта

#### Интеграция с Backend

Все страницы Finance модуля интегрированы с REST API:
- Загрузка финансовых отчётов с фильтрацией
- Создание новых финансовых строк
- Получение P&L отчёта с агрегатами

#### Компоненты

- Используются Shadcn UI компоненты: `Dialog`, `Table`, `Card`, `Button`, `Input`, `Select`
- Модальные окна для ввода данных
- Карточки для отображения метрик P&L

### Advertising Module — Модуль рекламы

Модуль для управления рекламными кампаниями и их статистикой реализован на этапе 0.

#### Страницы

- **`/advertising/campaigns`** — список кампаний
  - Таблица кампаний с колонками: Name, Marketplace, Status, Budget, Total Spend, Total Revenue, Total Orders
  - Фильтры по статусу и поиск по названию
  - Модальное окно для создания новой кампании
  - Поля формы: Marketplace, Name, Status, Budget
  
- **`/advertising/campaigns/[id]`** — карточка кампании
  - Информация о кампании (название, маркетплейс, статус, бюджет)
  - Возможность изменить статус кампании
  - Карточки с агрегатами: Total Spend, Total Revenue, Total Orders, ROAS
  - Таблица дневной статистики с колонками:
    - Date, Impressions, Clicks, CTR (computed), CPC (computed), Spend, Orders, Revenue
  - Фильтр по дате (от/до)
  - Модальное окно для добавления статистики за день
  - Возможность редактирования существующей статистики

#### Интеграция с Backend

Все страницы Advertising модуля интегрированы с REST API:
- Загрузка списка кампаний с фильтрацией
- Создание и обновление кампаний
- Получение детальной информации о кампании со статистикой
- Создание и редактирование статистики

#### Компоненты

- Используются Shadcn UI компоненты: `Dialog`, `Table`, `Card`, `Button`, `Input`, `Select`
- Модальные окна для создания/редактирования кампаний и статистики
- Карточки для отображения агрегированных показателей
- Таблицы с вычисляемыми полями (CTR, CPC)

### Support Module — Модуль поддержки

Модуль для управления отзывами и обращениями в поддержку реализован на этапе 0.

#### Страницы

- **`/support/reviews`** — список отзывов
  - Таблица отзывов с колонками: Date, SKU, Rating, Text
  - Фильтры: Rating (точный), Min Rating, SKU Code, Date range
  - Модальное окно для просмотра полного текста отзыва
  - Ссылки на товары из отзывов
  
- **`/support/tickets`** — список тикетов
  - Таблица тикетов с колонками: ID, Title, Status, CreatedAt, UpdatedAt
  - Модальное окно для создания нового тикета
  - Переход к детальной информации о тикете
  
- **`/support/tickets/[id]`** — детальная информация о тикете
  - Информация о тикете (title, описание, статус, даты)
  - Возможность изменить статус через dropdown
  - Статусы: NEW, IN_PROGRESS, RESOLVED, CLOSED

#### Интеграция с Backend

Все страницы Support модуля интегрированы с REST API:
- Загрузка отзывов с фильтрацией
- Создание отзывов (для тестирования)
- Загрузка списка тикетов
- Создание и обновление статуса тикетов

#### Компоненты

- Используются Shadcn UI компоненты: `Badge`, `Dialog`, `Table`, `Card`, `Button`, `Input`, `Select`, `Textarea`
- Модальные окна для создания тикетов и просмотра отзывов
- Badge компоненты для отображения статусов и рейтингов

### Analytics Module — Модуль аналитики

Модуль для агрегации и анализа бизнес-данных реализован на этапе 0.

#### Страница

- **`/analytics`** — аналитический дашборд
  - **Секция 1: Карточки summary** — 6 карточек в виде решётки 3x2:
    - Revenue (общий доход)
    - Orders (количество заказов)
    - Gross Margin (валовая прибыль)
    - Gross Margin % (процент валовой прибыли)
    - Ad Spend (расходы на рекламу)
    - ROAS (Return on Ad Spend)
  
  - **Секция 2: Продажи** — таблица продаж за период:
    - Колонки: Date, Revenue, Orders, Refunds
    - Данные агрегируются по дням из FinanceReport
  
  - **Секция 3: Реклама** — таблица агрегатов по дням:
    - Колонки: Date, Impressions, Clicks, CTR (computed), Spend, Orders, Revenue, ROAS (computed)
    - Данные из AdStats, сгруппированные по датам
  
  - **Секция 4: Топ негативных отзывов** — таблица первых 10 отзывов с рейтингом ≤ 2:
    - Колонки: Date, SKU, Rating, Text (с обрезкой)
  
  - **Фильтр по дате** — date range picker в верхней части страницы для фильтрации данных

#### Интеграция с Backend

Страница Analytics интегрирована с REST API:
- Загрузка агрегатов дашборда с фильтрацией по дате
- Загрузка данных по продажам из Finance модуля
- Загрузка данных по рекламе из Advertising модуля
- Загрузка негативных отзывов из Support модуля

#### Компоненты

- Используются Shadcn UI компоненты: `Card`, `Table`, `Button`, `Input`, `Label`
- Карточки для отображения ключевых метрик
- Таблицы с вычисляемыми полями (CTR, ROAS)
- Фильтр по дате для настройки периода анализа

## Layout

### Основной layout

Приложение использует единый layout (`MainLayout`), который включает:

- **Верхнее меню** — навигация по разделам
- **Шапка** — логотип/название слева, меню разделов, блок пользователя справа
- **Контент** — область с контентом на светлом фоне

### Стиль дизайна

Дизайн вдохновлён Ozon Seller:

- Верхняя горизонтальная панель на всю ширину
- Логотип/название слева
- Меню разделов посередине
- Блок с пользователем справа
- Контент-область с белыми карточками на светло-сером фоне
- Минималистичный, современный вид без перегруза

### Навигация

Верхнее меню (`TopNav`):

- Горизонтальное меню со ссылками на все разделы
- Активный пункт подсвечивается (border-bottom и цвет)
- Hover эффекты для интерактивности

## UI библиотеки

### Tailwind CSS

Используется для стилизации:
- Utility-first подход
- Responsive дизайн
- Темы через CSS переменные

### Shadcn UI

Набор компонентов на основе Radix UI:

- **Button** — кнопки
- **Card** — карточки для контента

Дополнительные компоненты можно добавить командой:
```bash
pnpm dlx shadcn@latest add [component-name]
```

## Разработка

### Добавление новых компонентов Shadcn UI

```bash
pnpm dlx shadcn@latest add [component-name]
```

Доступные компоненты: https://ui.shadcn.com/docs/components

### Добавление нового раздела

1. Создать страницу в `app/[module]/page.tsx`
2. Добавить пункт меню в `components/top-nav.tsx`
3. Добавить карточку на главную страницу (`app/page.tsx`)

### Стилизация

- Глобальные стили: `app/globals.css`
- Конфигурация Tailwind: `tailwind.config.ts`
- Утилиты для классов: `lib/utils.ts` (функция `cn`)

## Тестирование

### Playwright Smoke Tests

Для запуска Playwright-тестов локально после установки зависимостей обязательно выполните:

```bash
pnpm --filter frontend exec playwright install
```

Это скачает необходимые браузерные бинарники для Playwright.

Затем можно запустить smoke-тесты:

```bash
# Из корня монорепозитория
pnpm test:smoke

# Или из директории frontend
cd frontend
pnpm test:smoke
```

## Сборка для production

```bash
pnpm -F frontend build
pnpm -F frontend start
```

## Дополнительные ресурсы

- [Next.js Documentation](https://nextjs.org/docs)
- [Tailwind CSS Documentation](https://tailwindcss.com/docs)
- [Shadcn UI Documentation](https://ui.shadcn.com)
- [Radix UI Documentation](https://www.radix-ui.com)
