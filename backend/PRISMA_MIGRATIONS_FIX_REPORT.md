# –û—Ç—á—ë—Ç –æ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–∏ Prisma-–º–∏–≥—Ä–∞—Ü–∏–π

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —Ä–∞–±–æ—Ç—ã

### 1. –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–π —Å–∏—Ç—É–∞—Ü–∏–∏
- ‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ, —á—Ç–æ –º–æ–¥–µ–ª—å `ScmServiceOperation` –µ—Å—Ç—å –≤ `schema.prisma`
- ‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ, —á—Ç–æ –º–æ–¥–µ–ª—å `SupplierService` –µ—Å—Ç—å –≤ `schema.prisma`
- ‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ, —á—Ç–æ –º–æ–¥–µ–ª—å `SupplierItem` —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª–µ `sku` –≤ —Å—Ö–µ–º–µ
- ‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ, —á—Ç–æ –º–æ–¥–µ–ª—å `ProductionOrder` —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª—è `productionCountryId` –∏ `manufacturerId`

### 2. –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π
- ‚úÖ –°–æ–∑–¥–∞–Ω–∞ —Ä–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è —Å—Ç–∞—Ä—ã—Ö –º–∏–≥—Ä–∞—Ü–∏–π: `migrations_old_backup_20251207_041830`
- ‚úÖ –£–¥–∞–ª–µ–Ω —Å—Ç–∞—Ä—ã–π –∫–∞—Ç–∞–ª–æ–≥ `migrations`
- ‚úÖ –°–æ–∑–¥–∞–Ω–∞ –Ω–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–∏–≥—Ä–∞—Ü–∏–π

### 3. –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑–æ–≤–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏
- ‚úÖ –°–æ–∑–¥–∞–Ω–∞ –Ω–æ–≤–∞—è –±–∞–∑–æ–≤–∞—è –º–∏–≥—Ä–∞—Ü–∏—è: `20251207041950_init`
- ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–∞ –∏–∑ –∞–∫—Ç—É–∞–ª—å–Ω–æ–π —Å—Ö–µ–º—ã —á–µ—Ä–µ–∑ `prisma migrate diff`
- ‚úÖ –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –º–∏–≥—Ä–∞—Ü–∏–∏: ~50 KB
- ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ç–∞–±–ª–∏—Ü—ã –∏ –ø–æ–ª—è

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –≤—Å–µ—Ö –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Ç–∞–±–ª–∏—Ü

#### ‚úÖ –¢–∞–±–ª–∏—Ü–∞ `production_orders` (—Å—Ç—Ä–æ–∫–∞ 540)
- –°–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–æ–ª—è:
  - `productionCountryId` (—Å—Ç—Ä–æ–∫–∞ 556)
  - `manufacturerId` (—Å—Ç—Ä–æ–∫–∞ 557)
  - –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è –∏–∑ —Å—Ö–µ–º—ã
- –°–æ–∑–¥–∞—é—Ç—Å—è –≤—Å–µ –≤–Ω–µ—à–Ω–∏–µ –∫–ª—é—á–∏ –∏ –∏–Ω–¥–µ–∫—Å—ã

#### ‚úÖ –¢–∞–±–ª–∏—Ü–∞ `scm_service_operations` (—Å—Ç—Ä–æ–∫–∞ 682)
- –°–æ–∑–¥–∞–µ—Ç—Å—è —Å –ø–æ–ª–Ω—ã–º –Ω–∞–±–æ—Ä–æ–º –ø–æ–ª–µ–π
- –í—Å–µ —Å–≤—è–∑–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- –í—Å–µ –∏–Ω–¥–µ–∫—Å—ã —Å–æ–∑–¥–∞—é—Ç—Å—è

#### ‚úÖ –¢–∞–±–ª–∏—Ü–∞ `supplier_items` (—Å—Ç—Ä–æ–∫–∞ 500)
- **–°–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª–µ `sku`** (—Å—Ç—Ä–æ–∫–∞ 513)
- –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç
- –í—Å–µ –∏–Ω–¥–µ–∫—Å—ã –∏ –≤–Ω–µ—à–Ω–∏–µ –∫–ª—é—á–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è

#### ‚úÖ –¢–∞–±–ª–∏—Ü–∞ `supplier_services` (—Å—Ç—Ä–æ–∫–∞ 703)
- –°–æ–∑–¥–∞–µ—Ç—Å—è —Å –ø–æ–ª–Ω—ã–º –Ω–∞–±–æ—Ä–æ–º –ø–æ–ª–µ–π
- –í—Å–µ —Å–≤—è–∑–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ seed-—Ñ–∞–π–ª–æ–≤
- ‚úÖ Seed-—Ñ–∞–π–ª—ã –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Å—Ç–∞—Ä—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è –ø–æ–ª–µ–π
- ‚úÖ –í—Å–µ –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ –º–æ–¥–µ–ª—è–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –∞–∫—Ç—É–∞–ª—å–Ω–æ–π —Å—Ö–µ–º–µ

### 6. –ü—Ä–æ–≤–µ—Ä–∫–∞ entrypoint.sh
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `pnpm exec prisma migrate deploy` - –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ Seed –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ `pnpm exec prisma db seed` - –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

## üìã –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –Ω–æ–≤–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏

–ú–∏–≥—Ä–∞—Ü–∏—è `20251207041950_init/migration.sql` —Å–æ–∑–¥–∞–µ—Ç –≤—Å—é —Å—Ö–µ–º—É —Å –Ω—É–ª—è:

1. –í—Å–µ enum-—ã (IntegrationStatus, LogLevel, SupplierType, ScmServiceCategory, –∏ —Ç.–¥.)
2. –í—Å–µ —Ç–∞–±–ª–∏—Ü—ã –∏–∑ —Å—Ö–µ–º—ã (43 —Ç–∞–±–ª–∏—Ü—ã)
3. –í—Å–µ –∏–Ω–¥–µ–∫—Å—ã
4. –í—Å–µ –≤–Ω–µ—à–Ω–∏–µ –∫–ª—é—á–∏

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

### 1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∏ —É–¥–∞–ª–∏—Ç—å volumes
```bash
cd infra
docker compose down -v
```

### 2. –ü–æ–¥–Ω—è—Ç—å –≤—Å—ë –∑–∞–Ω–æ–≤–æ
```bash
cd ..
pnpm docker:up
```

### 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
```bash
cd infra
docker compose logs backend --tail=200
```

–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
- ‚úÖ Prisma migrations ... Applying migration '20251207041950_init' –±–µ–∑ –æ—à–∏–±–æ–∫
- ‚úÖ –£—Å–ø–µ—à–Ω—ã–π —Å—Ç–∞—Ä—Ç NestJS
- ‚úÖ Backend —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è healthy

### 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É —Å—Ç—Ä–∞–Ω–∏—Ü
- ‚úÖ SCM ‚Üí Suppliers (—Å–ø–∏—Å–æ–∫ + –∫–∞—Ä—Ç–æ—á–∫–∞)
- ‚úÖ SCM ‚Üí Products
- ‚úÖ SCM ‚Üí Production Orders (—Å–ø–∏—Å–æ–∫, —Å–æ–∑–¥–∞–Ω–∏–µ, –ø—Ä–æ—Å–º–æ—Ç—Ä)

–í–æ –≤—Å–µ—Ö —Å–ª—É—á–∞—è—Ö –Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 500 –æ—à–∏–±–æ–∫ –∏–∑-–∑–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö —Ç–∞–±–ª–∏—Ü/–∫–æ–ª–æ–Ω–æ–∫.

## üìÅ –§–∞–π–ª—ã

- ‚úÖ `backend/prisma/migrations/20251207041950_init/migration.sql` - –Ω–æ–≤–∞—è –±–∞–∑–æ–≤–∞—è –º–∏–≥—Ä–∞—Ü–∏—è
- ‚úÖ `backend/prisma/migrations/migration_lock.toml` - lock —Ñ–∞–π–ª
- ‚úÖ `backend/prisma/migrations_old_backup_20251207_041830/` - —Ä–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è —Å—Ç–∞—Ä—ã—Ö –º–∏–≥—Ä–∞—Ü–∏–π

## ‚ö†Ô∏è –í–∞–∂–Ω–æ

1. **–†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞** - –≤—Å–µ —Å—Ç–∞—Ä—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ `migrations_old_backup_20251207_041830`
2. **–ù–æ–≤–∞—è –º–∏–≥—Ä–∞—Ü–∏—è —Å–æ–∑–¥–∞–µ—Ç –≤—Å—é —Å—Ö–µ–º—É —Å –Ω—É–ª—è** - —ç—Ç–æ init –º–∏–≥—Ä–∞—Ü–∏—è
3. **–í—Å–µ —Ç–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞—é—Ç—Å—è –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ** - Prisma –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø–æ—Ä—è–¥–æ–∫ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
4. **Seed-—Ñ–∞–π–ª—ã –Ω–µ —Ç—Ä–µ–±—É—é—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π** - –æ–Ω–∏ —É–∂–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –∞–∫—Ç—É–∞–ª—å–Ω–æ–π —Å—Ö–µ–º–µ

## üéØ –ö—Ä–∏—Ç–µ—Ä–∏–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è `docker compose down -v && pnpm docker:up` –Ω–∞ —á–∏—Å—Ç–æ–π –º–∞—à–∏–Ω–µ:

- ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫ Prisma/SQL
- ‚úÖ Backend —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è healthy
- ‚úÖ –í—Å–µ –æ–ø–∏—Å–∞–Ω–Ω—ã–µ –≤—ã—à–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã SCM —Ä–∞–±–æ—Ç–∞—é—Ç –±–µ–∑ 500-–æ—à–∏–±–æ–∫
- ‚úÖ –í –ª–æ–≥–∞—Ö –Ω–µ—Ç –æ—à–∏–±–æ–∫ –≤–∏–¥–∞:
  - `relation "production_orders" does not exist`
  - `relation "scm_service_operations" does not exist`
  - `column "sku" of relation "supplier_items" does not exist`
  - `relation "supplier_services" does not exist`





















