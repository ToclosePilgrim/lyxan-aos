# ERD Structure - Visual Representation

## Entity Relationship Diagram для AOS v0

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          ORGANIZATIONAL STRUCTURE                           │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────┐       ┌──────────┐       ┌──────────────┐
│  Country    │──────>│  Brand   │──────>│ Marketplace  │
│             │  1:N  │          │  1:N  │              │
│ - id        │       │ - id     │       │ - id         │
│ - name      │       │ - name   │       │ - name       │
│             │       │ - countryId│     │ - brandId    │
└─────────────┘       └──────────┘       └──────────────┘
                                │                  │
                                │                  │
                                │ 1:N              │ 1:N
                                │                  │
                                ▼                  ▼
                        ┌──────────────┐  ┌──────────────┐
                        │   Product    │──│ AdCampaign   │
                        │              │  │              │
                        │ - id         │  │ - id         │
                        │ - name       │  │ - name       │
                        │ - brandId    │  │ - marketplaceId│
                        │ - marketplaceId│ │ - status    │
                        │ - category   │  │ - budget     │
                        └──────────────┘  └──────────────┘
                                │                  │
                                │ 1:1              │ 1:N
                                │                  │
                                ▼                  ▼
                        ┌──────────────┐  ┌──────────────┐
                        │ ProductCard  │  │   AdStats    │
                        │              │  │              │
                        │ - id         │  │ - id         │
                        │ - productId  │  │ - campaignId │
                        │ - title      │  │ - date       │
                        │ - description│  │ - impressions│
                        │ - attributes │  │ - clicks     │
                        │ - images     │  │ - spend      │
                        └──────────────┘  └──────────────┘
                                │
                                │ 1:N
                                │
                                ▼
                        ┌──────────────┐
                        │     SKU      │
                        │              │
                        │ - id         │
                        │ - productId  │
                        │ - code (UK)  │
                        │ - name       │
                        │ - price      │
                        │ - cost       │
                        └──────────────┘
                                │
                    ┌───────────┼───────────┐
                    │           │           │
                1:1 │       1:N │       1:N │
                    │           │           │
                    ▼           ▼           ▼
          ┌──────────────┐ ┌──────────────┐ ┌──────────────┐
          │    Stock     │ │SupplyItem    │ │FinanceReport │
          │              │ │              │ │              │
          │ - id         │ │ - id         │ │ - id         │
          │ - skuId (UK) │ │ - supplyId   │ │ - skuId      │
          │ - quantity   │ │ - skuId      │ │ - date       │
          └──────────────┘ │ - quantity   │ │ - quantity   │
                           └──────────────┘ │ - revenue    │
                                    │       │ - commission │
                                    │ 1:N   │ - refunds    │
                                    │       └──────────────┘
                                    │
                                    │
                                    ▼
                          ┌──────────────┐
                          │   Supply     │
                          │              │
                          │ - id         │
                          │ - status     │
                          │ - createdAt  │
                          └──────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│                            USERS & ROLES                                    │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────┐       ┌──────────┐
│    Role     │──────>│   User   │
│             │  1:N  │          │
│ - id        │       │ - id     │
│ - name (UK) │       │ - email (UK)│
│             │       │ - password│
└─────────────┘       │ - roleId │
                      └──────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│                              SUPPORT                                        │
└─────────────────────────────────────────────────────────────────────────────┘

┌──────────────┐       ┌──────────────┐
│   Review     │       │SupportTicket │
│              │       │              │
│ - id         │       │ - id         │
│ - skuId (opt)│       │ - text       │
│ - rating     │       │ - status     │
│ - text       │       │ - createdAt  │
│ - date       │       └──────────────┘
└──────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│                               AGENTS                                        │
└─────────────────────────────────────────────────────────────────────────────┘

┌──────────────┐       ┌──────────────┐
│AgentScenario │──────>│  AgentRun    │
│              │  1:N  │              │
│ - id         │       │ - id         │
│ - key (UK)   │       │ - scenarioId (opt)│
│ - name       │       │ - agentKey   │
│ - endpoint   │       │ - input      │
└──────────────┘       │ - output     │
                       │ - status     │
                       │ - error      │
                       │ - startedAt  │
                       │ - finishedAt │
                       └──────────────┘
```

## Таблицы по группам

### 1. Организационная структура (3 таблицы)
- **countries** — страны работы системы
- **brands** — бренды, привязанные к странам
- **marketplaces** — маркетплейсы для продажи

### 2. Пользователи (2 таблицы)
- **roles** — роли пользователей
- **users** — пользователи системы

### 3. SCM — Supply Chain Management (5 таблиц)
- **products** — товары бренда
- **skus** — единицы товара с ценами
- **stocks** — остатки на складе
- **supplies** — поставки товаров
- **supply_items** — элементы поставок

### 4. BCM — Brand & Catalog Management (1 таблица)
- **product_cards** — расширенная информация о товарах

### 5. Finance (1 таблица)
- **finance_reports** — финансовые отчёты по продажам

### 6. Advertising (2 таблицы)
- **ad_campaigns** — рекламные кампании
- **ad_stats** — статистика по кампаниям

### 7. Support (2 таблицы)
- **reviews** — отзывы клиентов
- **support_tickets** — тикеты поддержки

### 8. Agents (2 таблицы)
- **agent_scenarios** — сценарии для AI-агентов
- **agent_runs** — логи выполнения агентов

**Всего таблиц: 19**

## Ключевые особенности

- ✅ Все связи настроены с правильными каскадными удалениями
- ✅ Опциональные связи: Product ↔ Marketplace, Review ↔ SKU
- ✅ Уникальные ограничения: email, code, key
- ✅ Индексы для оптимизации частых запросов
- ✅ JSONB поля для гибких данных (attributes, images, input/output)



























