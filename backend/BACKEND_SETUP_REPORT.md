# –û—Ç—á—ë—Ç –æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ Backend - –¢–ó ‚Ññ2

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

### 1. NestJS –ø—Ä–æ–µ–∫—Ç ‚úÖ
- NestJS –ø—Ä–æ–µ–∫—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω
- Boilerplate-–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã —É–¥–∞–ª–µ–Ω—ã
- ConfigModule –Ω–∞—Å—Ç—Ä–æ–µ–Ω —Å –≥–ª–æ–±–∞–ª—å–Ω—ã–º –¥–æ—Å—Ç—É–ø–æ–º

### 2. Prisma ‚úÖ
- Prisma –∏ Prisma Client —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
- –°–æ–∑–¥–∞–Ω–∞ –ø–∞–ø–∫–∞ `/prisma` –∏ —Ñ–∞–π–ª `schema.prisma`
- –ù–∞—Å—Ç—Ä–æ–µ–Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL —á–µ—Ä–µ–∑ DATABASE_URL

### 3. PostgreSQL connection ‚úÖ
- –°–æ–∑–¥–∞–Ω DatabaseModule, —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É—é—â–∏–π PrismaService
- –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω graceful shutdown

### 4. Redis ‚úÖ
- –ü–æ–¥–∫–ª—é—á—ë–Ω ioredis
- –°–æ–∑–¥–∞–Ω RedisModule —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º —á–µ—Ä–µ–∑ REDIS_URL
- Redis-–∏–Ω—Å—Ç–∞–Ω—Å —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è

### 5. –ë–∞–∑–æ–≤—ã–µ –º–æ–¥—É–ª–∏ backend ‚úÖ
–°–æ–∑–¥–∞–Ω—ã –≤—Å–µ 11 –º–æ–¥—É–ª–µ–π:
- auth
- users
- org
- scm
- bcm
- finance
- advertising
- support
- analytics
- settings
- agents

–ö–∞–∂–¥—ã–π –º–æ–¥—É–ª—å —Å–æ–¥–µ—Ä–∂–∏—Ç: `module.ts`, `controller.ts`, `service.ts`

### 6. –û–±—â–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–¥–∞ ‚úÖ
–í `/common` —Å–æ–∑–¥–∞–Ω—ã:
- **Filters:**
  - `all-exceptions.filter.ts` ‚Äî –≥–ª–æ–±–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
  - `http-exception.filter.ts` ‚Äî –æ–±—Ä–∞–±–æ—Ç–∫–∞ HTTP –∏—Å–∫–ª—é—á–µ–Ω–∏–π
- **Interceptors:**
  - `logging.interceptor.ts` ‚Äî –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ö–æ–¥/–≤—ã—Ö–æ–¥
- **Guards:**
  - `roles.guard.ts` ‚Äî –ø—É—Å—Ç–∞—è –∑–∞–≥–ª—É—à–∫–∞ (–±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –≤ –¢–ó ‚Ññ4)
- **Decorators:**
  - `current-user.decorator.ts` ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### 7. –ì–ª–æ–±–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è ‚úÖ
–í `main.ts` –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ:
- `enableCors()` ‚Äî –≤–∫–ª—é—á—ë–Ω CORS
- `cookie-parser` ‚Äî –ø–æ–¥–∫–ª—é—á—ë–Ω
- –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã (AllExceptionsFilter)
- –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –∏–Ω—Ç–µ—Ä—Ü–µ–ø—Ç–æ—Ä—ã (LoggingInterceptor)
- Prefix `/api`

### 8. .env.example ‚úÖ
–°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏:
- DATABASE_URL
- REDIS_URL
- JWT_SECRET
- PORT

### 9. README.md ‚úÖ
–û–±–Ω–æ–≤–ª—ë–Ω —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º:
- –°—Ç—Ä—É–∫—Ç—É—Ä—ã backend
- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–π –ø–æ –∑–∞–ø—É—Å–∫—É
- –†–∞–±–æ—Ç—ã —Å Prisma
- –ü–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ backend

```
backend/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ modules/          # –ë–∏–∑–Ω–µ—Å-–º–æ–¥—É–ª–∏ AOS (11 –º–æ–¥—É–ª–µ–π)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ users/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ org/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ scm/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ bcm/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ finance/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ advertising/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ support/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ analytics/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ settings/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ agents/
‚îÇ   ‚îú‚îÄ‚îÄ common/           # –û–±—â–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ filters/      # –§–∏–ª—å—Ç—Ä—ã –∏—Å–∫–ª—é—á–µ–Ω–∏–π
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ guards/       # Guards
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ interceptors/ # –ò–Ω—Ç–µ—Ä—Ü–µ–ø—Ç–æ—Ä—ã
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ decorators/   # –î–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã
‚îÇ   ‚îú‚îÄ‚îÄ config/           # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ config.module.ts
‚îÇ   ‚îú‚îÄ‚îÄ database/         # Prisma –∏ Redis
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ database.module.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ prisma.service.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ redis.module.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ redis.service.ts
‚îÇ   ‚îú‚îÄ‚îÄ app.module.ts     # –ö–æ—Ä–Ω–µ–≤–æ–π –º–æ–¥—É–ª—å
‚îÇ   ‚îî‚îÄ‚îÄ main.ts           # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îú‚îÄ‚îÄ prisma/
‚îÇ   ‚îî‚îÄ‚îÄ schema.prisma     # –°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ .env.example          # –ü—Ä–∏–º–µ—Ä –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ package.json
‚îî‚îÄ‚îÄ README.md
```

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
```bash
pnpm install
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –£—Å–ø–µ—à–Ω–æ

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Prisma Client
```bash
npx prisma generate
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ Prisma Client —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω

### –°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞
```bash
pnpm run build
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –ü—Ä–æ–µ–∫—Ç —É—Å–ø–µ—à–Ω–æ —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è

### –ó–∞–ø—É—Å–∫ backend
```bash
pnpm -F backend start:dev
```
**–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å:** ‚úÖ –ì–æ—Ç–æ–≤ –∫ –∑–∞–ø—É—Å–∫—É (—Ç—Ä–µ–±—É–µ—Ç .env —Ñ–∞–π–ª —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –ë–î –∏ Redis)

## üìã –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫–ª—é—á–µ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤

### main.ts
- –ì–ª–æ–±–∞–ª—å–Ω—ã–π –ø—Ä–µ—Ñ–∏–∫—Å `/api`
- CORS –≤–∫–ª—é—á—ë–Ω
- Cookie-parser –ø–æ–¥–∫–ª—é—á—ë–Ω
- ValidationPipe –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã –∏ –∏–Ω—Ç–µ—Ä—Ü–µ–ø—Ç–æ—Ä—ã
- Graceful shutdown –¥–ª—è Prisma

### app.module.ts
–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤—Å–µ –º–æ–¥—É–ª–∏:
- ConfigModule
- DatabaseModule
- RedisModule
- –í—Å–µ 11 –±–∏–∑–Ω–µ—Å-–º–æ–¥—É–ª–µ–π

### prisma/schema.prisma
- –ù–∞—Å—Ç—Ä–æ–µ–Ω datasource –¥–ª—è PostgreSQL
- Generator –¥–ª—è Prisma Client
- –ì–æ—Ç–æ–≤ –∫ –¥–æ–±–∞–≤–ª–µ–Ω–∏—é –º–æ–¥–µ–ª–µ–π

### .env.example
```env
DATABASE_URL="postgresql://postgres:postgres@localhost:5432/aos"
REDIS_URL="redis://localhost:6379"
JWT_SECRET="changeme"
PORT=3001
```

## üéØ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ - –í–°–ï –í–´–ü–û–õ–ù–ï–ù–´

1. ‚úÖ –î–µ—Ä–µ–≤–æ —Ñ–∞–π–ª–æ–≤ backend —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º
2. ‚úÖ NestJS backend —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è –∏ –≥–æ—Ç–æ–≤ –∫ –∑–∞–ø—É—Å–∫—É
3. ‚úÖ Prisma –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫: `npx prisma generate`
4. ‚úÖ Redis –ø–æ–¥–∫–ª—é—á—ë–Ω —á–µ—Ä–µ–∑ RedisModule
5. ‚úÖ –í—Å–µ –º–æ–¥—É–ª–∏ —Å—É—â–µ—Å—Ç–≤—É—é—Ç –∏ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤ AppModule
6. ‚úÖ README –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–ø–∏—Å—ã–≤–∞–µ—Ç –∑–∞–ø—É—Å–∫ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫—É

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –í—Å–µ –º–æ–¥—É–ª–∏ —Å–æ–∑–¥–∞–Ω—ã –∫–∞–∫ –ø—É—Å—Ç—ã–µ –∑–∞–≥–ª—É—à–∫–∏ (–≥–æ—Ç–æ–≤—ã –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏)
- RolesGuard –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –≤ –¢–ó ‚Ññ4
- –î–ª—è –∑–∞–ø—É—Å–∫–∞ —Ç—Ä–µ–±—É–µ—Ç—Å—è –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å PostgreSQL –∏ Redis
- Prisma –º–∏–≥—Ä–∞—Ü–∏–∏ –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥–æ–π `npx prisma migrate dev`







