# –û—Ç—á—ë—Ç –æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ Finance Module v0 - –¢–ó ‚Ññ11

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–æ–¥–µ–ª–∏ Prisma ‚úÖ
–ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ –º–æ–¥–µ–ª—å:
- ‚úÖ `FinanceReport` ‚Äî —Å—É—â–µ—Å—Ç–≤—É–µ—Ç —Å –ø–æ–ª—è–º–∏: `id`, `skuId`, `date`, `quantity`, `revenue`, `commission`, `refunds`, `createdAt`
- ‚úÖ –ú–æ–¥–µ–ª—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º

### 2. Backend: FinanceService ‚úÖ
–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –º–µ—Ç–æ–¥—ã:

**Reports:**
- ‚úÖ `getReports(filter?)` ‚Äî —Å–ø–∏—Å–æ–∫ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –æ—Ç—á—ë—Ç–æ–≤ —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π:
  - –ü–æ SKU (`skuId`)
  - –ü–æ –¥–∞—Ç–µ (`date`)
  - –ü–æ –¥–∏–∞–ø–∞–∑–æ–Ω—É –¥–∞—Ç (`dateFrom`, `dateTo`)
  - –° –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π (`limit`, `offset`)
- ‚úÖ `createReport(dto)` ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏

**P&L:**
- ‚úÖ `getPnl(dateFrom?, dateTo?)` ‚Äî —Ä–∞—Å—á—ë—Ç P&L —Å –∞–≥—Ä–µ–≥–∞—Ç–∞–º–∏:
  - `totalRevenue` ‚Äî –æ–±—â–∞—è –≤—ã—Ä—É—á–∫–∞
  - `totalCommission` ‚Äî –æ–±—â–∞—è –∫–æ–º–∏—Å—Å–∏—è
  - `totalRefunds` ‚Äî –æ–±—â–∏–µ –≤–æ–∑–≤—Ä–∞—Ç—ã
  - `totalCost` ‚Äî –æ–±—â–∞—è —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å (–∏–∑ SKU.cost * quantity)
  - `grossMargin` ‚Äî –≤–∞–ª–æ–≤–∞—è –º–∞—Ä–∂–∞
  - `grossMarginPercent` ‚Äî –≤–∞–ª–æ–≤–∞—è –º–∞—Ä–∂–∞ –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö

### 3. Backend: FinanceController ‚úÖ
–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã REST —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã:

**Reports:**
- ‚úÖ `GET /api/finance/reports` ‚Äî —Å–ø–∏—Å–æ–∫ –æ—Ç—á—ë—Ç–æ–≤
- ‚úÖ `POST /api/finance/reports` ‚Äî —Å–æ–∑–¥–∞—Ç—å –æ—Ç—á—ë—Ç

**P&L:**
- ‚úÖ `GET /api/finance/pnl` ‚Äî –ø–æ–ª—É—á–∏—Ç—å P&L –æ—Ç—á—ë—Ç

–í—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –∑–∞—â–∏—â–µ–Ω—ã `JwtAuthGuard`.

### 4. Backend: DTO ‚úÖ
–°–æ–∑–¥–∞–Ω DTO:
- ‚úÖ `CreateFinanceReportDto` ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–≥–æ –æ—Ç—á—ë—Ç–∞

### 5. Frontend: –°—Ç—Ä–∞–Ω–∏—Ü—ã ‚úÖ
–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã —Å—Ç—Ä–∞–Ω–∏—Ü—ã:

**`/finance/sales`**
- ‚úÖ –¢–∞–±–ª–∏—Ü–∞ –ø—Ä–æ–¥–∞–∂ —Å –∫–æ–ª–æ–Ω–∫–∞–º–∏: Date, SKU Code, Quantity, Revenue, Commission, Refunds
- ‚úÖ –§–∏–ª—å—Ç—Ä—ã –ø–æ –¥–∞—Ç–µ (–æ—Ç/–¥–æ) –∏ SKU
- ‚úÖ –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏
- ‚úÖ –§–æ—Ä–º–∞ —Å –ø–æ–ª—è–º–∏: SKU (–≤—ã–±–æ—Ä –∏–∑ —Å–ø–∏—Å–∫–∞), –¥–∞—Ç–∞, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ, revenue, commission, refunds

**`/finance/pnl`**
- ‚úÖ –ö–∞—Ä—Ç–æ—á–∫–∏ —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏ P&L:
  - Revenue
  - Commission
  - Refunds
  - Cost
  - Gross Margin
  - Gross Margin %
- ‚úÖ –§–∏–ª—å—Ç—Ä –ø–æ –¥–∞—Ç–µ (–æ—Ç/–¥–æ)
- ‚úÖ –ö–Ω–æ–ø–∫–∞ "–û–±–Ω–æ–≤–∏—Ç—å"

### 6. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è ‚úÖ
- ‚úÖ –í—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π `MainLayout`
- ‚úÖ –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —Å backend API —á–µ—Ä–µ–∑ `lib/api.ts`
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è Shadcn UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (Dialog, Table, Card, Button, Input, Select)

### 7. README –æ–±–Ω–æ–≤–ª—ë–Ω ‚úÖ
- ‚úÖ Backend README —Å–æ–¥–µ—Ä–∂–∏—Ç —Ä–∞–∑–¥–µ–ª FinanceModule —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º API
- ‚úÖ Frontend README —Å–æ–¥–µ—Ä–∂–∏—Ç –æ–ø–∏—Å–∞–Ω–∏–µ Finance —Å—Ç—Ä–∞–Ω–∏—Ü

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

### Backend
```
backend/src/modules/finance/
‚îú‚îÄ‚îÄ dto/
‚îÇ   ‚îî‚îÄ‚îÄ create-finance-report.dto.ts
‚îú‚îÄ‚îÄ finance.module.ts
‚îú‚îÄ‚îÄ finance.service.ts
‚îî‚îÄ‚îÄ finance.controller.ts
```

### Frontend
```
frontend/app/finance/
‚îú‚îÄ‚îÄ page.tsx (–Ω–∞–≤–∏–≥–∞—Ü–∏—è)
‚îú‚îÄ‚îÄ sales/
‚îÇ   ‚îî‚îÄ‚îÄ page.tsx
‚îî‚îÄ‚îÄ pnl/
    ‚îî‚îÄ‚îÄ page.tsx
```

## üìã API Endpoints

### Reports
- `GET /api/finance/reports` ‚Äî —Å–ø–∏—Å–æ–∫ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –æ—Ç—á—ë—Ç–æ–≤
- `POST /api/finance/reports` ‚Äî —Å–æ–∑–¥–∞—Ç—å —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–π –æ—Ç—á—ë—Ç

### P&L
- `GET /api/finance/pnl` ‚Äî –ø–æ–ª—É—á–∏—Ç—å P&L –æ—Ç—á—ë—Ç

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ - –í–°–ï –í–´–ü–û–õ–ù–ï–ù–´

1. ‚úÖ –ö–æ–¥ –º–æ–¥—É–ª—è backend (service/controller/DTO) —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
2. ‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ /finance/sales —Å–æ–∑–¥–∞–Ω–∞
3. ‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ /finance/pnl —Å–æ–∑–¥–∞–Ω–∞
4. ‚úÖ –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤ –æ–ø–∏—Å–∞–Ω—ã –≤ README
5. ‚úÖ –ü—Ä–æ–µ–∫—Ç—ã –∫–æ–º–ø–∏–ª–∏—Ä—É—é—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫

## üìù –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–≥–æ –æ—Ç—á—ë—Ç–∞
```bash
curl -X POST http://localhost:3001/api/finance/reports \
  -H "Content-Type: application/json" \
  -b cookies.txt \
  -d '{
    "skuId": "sku-id",
    "date": "2025-01-15",
    "quantity": 10,
    "revenue": 10000,
    "commission": 1500,
    "refunds": 500
  }'
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ P&L
```bash
curl -X GET "http://localhost:3001/api/finance/pnl?dateFrom=2025-01-01&dateTo=2025-01-31" \
  -b cookies.txt
```

## üéØ –°—Ç–∞—Ç—É—Å

**‚úÖ Finance Module v0 –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∏ –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!**

–ú–æ–¥—É–ª—å –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç:
- –í–≤–æ–¥ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö —Å—Ç—Ä–æ–∫ –ø—Ä–æ–¥–∞–∂ –≤—Ä—É—á–Ω—É—é
- –ü—Ä–æ—Å–º–æ—Ç—Ä –æ—Ç—á—ë—Ç–æ–≤ –ø–æ –ø—Ä–æ–¥–∞–∂–∞–º —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π
- –†–∞—Å—á—ë—Ç P&L —Å –∞–≥—Ä–µ–≥–∞—Ç–∞–º–∏
- –ë–∞–∑–æ–≤—ã–π —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–π –∞–Ω–∞–ª–∏–∑
- –ì–æ—Ç–æ–≤ –∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –∞–≥–µ–Ω—Ç–∞–º–∏ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∏–º–ø–æ—Ä—Ç–∞ –¥–∞–Ω–Ω—ã—Ö –≤ –±—É–¥—É—â–µ–º



























